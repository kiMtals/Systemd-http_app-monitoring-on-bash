# Если лень клонировать в files.rar все лежит
# README —  http_app+monitoring

Набор файлов поднимает простое `Hello World` HTTP-приложение и локальный мониторинг, который проверяет curl-ом http код и при необходимости перезапускает приложение. Всё управляется `systemd`. Установка/обновление — единый `install.sh`

---

## Содержание репозитория

Файлы, которые должны быть в папке:

* `app.py` — простой HTTP-сервер на python3
* `monitoring.sh` — скрипт мониторинга
* `monitoring.conf` — конфигурация (копируется в `/m_app/`)
* `http_app.service` — сервис для приложения
* `monitoring.service` — сервис для мониторинга, он ложится если не работает http_app, мне показалось это логичным
* `install.sh` — скрипт установки/обновления

---

# Быстрая установка

Сколонируй репозиторий в любую папку, при необходиомсти выдай chmod +x $"File"
всем скриптам

Запусти от root  в папке с  файлами:

```bash
./install.sh
```



* создаёт/обновляет директорию приложения  `/m_app` и копирует в нее файлы,
* копирует в `/etc/systemd/system/` .service
* запускает и ставит на автозапуск сервисы
> install.sh можно запускать повторно файлы сервисов обновляются, конфиг перезаписывается

---

# Конфигурация — `monitoring.conf`



```bash
URL=http://127.0.0.1:8080/ #эндпоинт проверки
LOG_FILE=/var/log/funny_monitoring.log
INTERVAL=10 # время между походами до эндпоинта
RETRY_AFTER_RESTART=3 # кол-во пыпток при неудачном походе с сервису
CURL_TIMEOUT=5 # таймаут для курла, чтобы не вис долго
APP_DIR=/m_app # кое-где захардкожено, лучше не менять
APP_PY=app.py # кое-где захардкожено, лучше не менять
APP_USER=root # кое-где захардкожено, лучше не менять
APP_GROUP=root # кое-где захардкожено, лучше не менять
```
в .service файлах, захаркожены некоторые переменные, если меняете здесь, то меняйте и там. я пока не стал добавлять генерацию .service файлов с нужными перменными, а из env они почему то не читают, анлак

---

# Отладка

Управление стандартно через systemd

### Логи

```bash
sudo journalctl -u http_app.service -f
sudo journalctl -u monitoring.service -f
```

### Локальный файл логов мониторинга

```bash
sudo tail -n 200 /var/log/funny_monitoring.log
```



